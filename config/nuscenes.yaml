# nuscenes_converter:
#   ros__parameters:
    # sensor_type: 'LinearGaussian'
    # sensor_variance: [.25, .25, .1]
    # dim_states: 6
    # dim_meas: 3

compute_nuscenes_node:
  ros__parameters:
    nuscenes_dir: '/home/jd/nuScenes/data'
    mcap_dir: '/home/jd/nuScenes/data/mcap'
    results_dir: '/home/jd/tracking_ws/src/ros_tracking/results'
    # dataset_name: 'v1.0-mini'
    split_name: 'val'
    lidar_detector: 'megvii'
    track_topic: 'tracks'
    det_topic: '/detections'

tracker:
  ros__parameters:
    tracker:
      dim_objects: 8
      object_classes: ['void_ignore',
           'bicycle',
           'bus',
           'car',
           'motorcycle',
           'pedestrian',
           'trailer',
           'truck']
      frame_id: 'map'
      asgn_thresh: 10.0
      # trk_timeout: 1.5
      publishers:
        # names: ['track_pub', 'scene_pub']
        names: ['track_pub']
        # names: ['scene_pub']
        track_pub: # Publisher name
          pub_topic: 'tracks'
          msg_type: 'Tracks3D'
          routine: 'PublishTracks'
        # scene_pub: # Publisher name
        #   pub_topic: 'tracks_scene'
        #   msg_type: 'SceneUpdate'
        #   routine: 'PublishScene'

      # Track management
      trk_mgmt_method: 'prob' # Count or prob
      del_thresh: 0.1 # track confidence below which track is deleted
      pub_thresh: 0.2 # track confidence above which track is published
      
      n_birth_min_list: [1, 3, 1, 1, 3, 1, 3, 1]
      n_age_max_list: [2, 2, 2, 2, 2, 2, 2, 2]

    sensors:

      #Declare names of sensors upfront
      sensor_names: ['nuscenes-megvii']

      # For each named sensor, give sensor model information
      nuscenes-megvii:
        detector_index: 0
        topic: 'converted_detections'
        msg_type: 'Detections3D'
        
        # Spatial sensor model
        spatial_sensor_model: [1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
                0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0.,
                0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0.,
                0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.]
        spatial_states: 15
        spatial_meas: 6
        sensor_variance: [.5, .25, .1, .01, .01, .01]

        # Semantic sensor model        
        dim_classes: 8
        dim_detections: 10
        detection_classes: ['barrier',
              'bicycle',
              'bus',
              'car',
              'construction_vehicle',
              'motorcycle',
              'pedestrian',
              'traffic_cone',
              'trailer',
              'truck']
        # p(Z_label|X_class): 
        # columns are dets:  barrier / bicycle / bus / car / construction_vehicle / motorcycle / pedestrian / traffic_cone / trailer / truck 
        semantic_sensor_model: [0.57, 0., 0., 0., 0.05, 0., 0., 0.38, 0., 0., # void_ignore - barrier, construction_vehicle, traffic cone
                        0., 1., 0., 0., 0., 0., 0., 0., 0., 0., # bicycle - 20% missed chance, 5% misclassification chance
                        0., 0., 1., 0., 0., 0., 0., 0., 0., 0., # bus
                        0., 0., 0., 1., 0., 0., 0., 0., 0., 0., # car
                        0., 0., 0., 0., 0., 1., 0., 0., 0., 0., # motorcycle
                        0., 0., 0., 0., 0., 0., 1., 0., 0., 0., # pedestrian
                        0., 0., 0., 0., 0., 0., 0., 0., 1., 0., # trailer
                        0.011429, 0.000000, 0.009524, 0.196190, 0.011429, 0.000000, 0.007619, 0.000000, 0.005714, 1.] # truck

        # p_missed_det: 0.30
        # p_false_pos: .60


        #                 void_ignore / bicycle / bus / car / motorcycle / pedestrian / trailer / truck

        # p_missed_det_list: [.2, .1, .2, .05, .2, .05, .2, .2] # heuristic
        p_missed_det_list: [.20, .33, .34, .25, .25, .20, .42, .36] # from validation training

        hist_bins: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1. ]
        false_pos_hist: [10314,  1797,   484,   177,    69,    26,    11,     3,     1, # 'void_ignore',
                        989, 114,  32,   9,   3,   1,   1,   1,   1, # 'bicycle',
                        436,  75,  25,   9,   3,   2,   1,   1,   1, # 'bus',
                        2332,  481,  157,   59,   36,   14,    8,    3,    1, # 'car',
                        840, 111,  25,  13,   3,   1,   1,   1,   1, # 'motorcycle',
                        1047,  218,   54,   10,    4,    1,    1,    1,    1, # 'pedestrian',
                        1162,  184,   30,   15,    3,    1,    1,    1,    1, # 'trailer',
                        1009,  167,   24,    9,    5,    4,    1,    1,    1] # 'truck'
        true_pos_hist: [7832, 4657, 4264, 2588, 1419,  845,  633,  914,  851, # 'void_ignore',
                        500, 200,  100,  75,  20,  20,   6,   6,   6, # 'bicycle',
                        59,  54,  15,   7,  10,   9,  10,  24, 107, # 'bus',
                        606, 339, 335, 337, 303, 408, 456, 784, 505, # 'car',
                        211,  40,  31,  23,  12,  14,  12,  12,  15, # 'motorcycle',
                        1648, 1814, 2016, 1101,  573,  163,   26,    26,    26, # 'pedestrian',
                        88, 15,  7,  1,  1,  1,  1,  2, 39, # 'trailer',
                        670, 151,  81,  58,  68,  48,  65,  51,  81] # 'truck'